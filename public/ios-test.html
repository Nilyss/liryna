<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Safari iOS - What a tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .test-box {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #26d0ce;
        }
        .error { border-left-color: #e74c3c; background: #fdf2f2; }
        .success { border-left-color: #27ae60; background: #f2fdf2; }
        .info { border-left-color: #3498db; background: #f2f8fd; }
        pre { background: #f8f8f8; padding: 10px; border-radius: 4px; overflow: auto; }
        button {
            background: #26d0ce;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>üß™ Diagnostic Safari iOS</h1>
    
    <div class="test-box info">
        <h3>üîç Informations du navigateur</h3>
        <div id="browser-info">Chargement...</div>
        <button onclick="updateBrowserInfo()">üîÑ Actualiser</button>
    </div>

    <div class="test-box">
        <h3>‚öôÔ∏è Tests JavaScript</h3>
        <div id="js-tests">Chargement...</div>
        <button onclick="runJSTests()">‚ñ∂Ô∏è Relancer les tests</button>
    </div>

    <div class="test-box">
        <h3>üì± Tests PWA</h3>
        <div id="pwa-tests">Chargement...</div>
        <button onclick="runPWATests()">‚ñ∂Ô∏è Tester PWA</button>
    </div>

    <div class="test-box">
        <h3>üöÄ Test de l'application</h3>
        <p>Si les tests ci-dessus r√©ussissent, essayons de charger l'app :</p>
        <button onclick="loadMainApp()">üéØ Charger What a tool</button>
        <div id="app-test"></div>
    </div>

    <script>
        function updateBrowserInfo() {
            const info = document.getElementById('browser-info');
            try {
                const browserInfo = {
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    cookieEnabled: navigator.cookieEnabled,
                    onLine: navigator.onLine,
                    language: navigator.language,
                    touchPoints: navigator.maxTouchPoints || 'N/A',
                    serviceWorker: 'serviceWorker' in navigator,
                    localStorage: typeof Storage !== 'undefined',
                    sessionStorage: typeof sessionStorage !== 'undefined',
                    fetch: typeof fetch !== 'undefined',
                    Promise: typeof Promise !== 'undefined',
                    matchMedia: typeof window.matchMedia !== 'undefined',
                    requestAnimationFrame: typeof requestAnimationFrame !== 'undefined'
                };

                info.innerHTML = '<pre>' + JSON.stringify(browserInfo, null, 2) + '</pre>';
            } catch (error) {
                info.innerHTML = '<div class="error">‚ùå Erreur: ' + error.message + '</div>';
            }
        }

        function runJSTests() {
            const results = document.getElementById('js-tests');
            const tests = [];

            // Test import.meta
            try {
                const hasImportMeta = typeof import !== 'undefined';
                tests.push('import keyword: ' + (hasImportMeta ? '‚úÖ' : '‚ùå'));
            } catch (e) {
                tests.push('import keyword: ‚ùå ' + e.message);
            }

            // Test modules ES6
            try {
                const testArrow = () => 'test';
                tests.push('Arrow functions: ' + (testArrow() === 'test' ? '‚úÖ' : '‚ùå'));
            } catch (e) {
                tests.push('Arrow functions: ‚ùå ' + e.message);
            }

            // Test destructuring
            try {
                const {test} = {test: 'ok'};
                tests.push('Destructuring: ' + (test === 'ok' ? '‚úÖ' : '‚ùå'));
            } catch (e) {
                tests.push('Destructuring: ‚ùå ' + e.message);
            }

            // Test async/await
            try {
                const testAsync = async () => 'test';
                tests.push('Async/await syntax: ‚úÖ');
            } catch (e) {
                tests.push('Async/await: ‚ùå ' + e.message);
            }

            // Test optional chaining
            try {
                const test = {}?.test?.deep;
                tests.push('Optional chaining: ‚úÖ');
            } catch (e) {
                tests.push('Optional chaining: ‚ùå ' + e.message);
            }

            results.innerHTML = tests.map(test => '<div>' + test + '</div>').join('');
        }

        function runPWATests() {
            const results = document.getElementById('pwa-tests');
            const tests = [];

            // Service Worker
            tests.push('Service Worker: ' + ('serviceWorker' in navigator ? '‚úÖ' : '‚ùå'));
            
            // Cache API
            tests.push('Cache API: ' + ('caches' in window ? '‚úÖ' : '‚ùå'));
            
            // Fetch API
            tests.push('Fetch API: ' + (typeof fetch !== 'undefined' ? '‚úÖ' : '‚ùå'));
            
            // Notifications
            tests.push('Notifications: ' + ('Notification' in window ? '‚úÖ' : '‚ùå'));
            
            // matchMedia
            tests.push('matchMedia: ' + (typeof window.matchMedia !== 'undefined' ? '‚úÖ' : '‚ùå'));

            // Display mode
            try {
                const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
                tests.push('Mode standalone: ' + (isStandalone ? '‚úÖ (install√©)' : '‚ùå (navigateur)'));
            } catch (e) {
                tests.push('Mode standalone: ‚ùå ' + e.message);
            }

            results.innerHTML = tests.map(test => '<div>' + test + '</div>').join('');
        }

        function loadMainApp() {
            const testDiv = document.getElementById('app-test');
            testDiv.innerHTML = '<p>üîÑ Tentative de chargement...</p>';
            
            try {
                // Simuler le chargement de l'app
                setTimeout(() => {
                    testDiv.innerHTML = `
                        <p>‚úÖ Test de base r√©ussi</p>
                        <p><a href="/" style="color: #26d0ce;">üöÄ Aller √† l'application</a></p>
                        <p><small>Si l'application ne charge pas, v√©rifiez les erreurs dans la console Safari (R√©glages > Safari > Avanc√© > Console Web)</small></p>
                    `;
                }, 1000);
            } catch (error) {
                testDiv.innerHTML = '<div class="error">‚ùå Erreur: ' + error.message + '</div>';
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            updateBrowserInfo();
            runJSTests();
            runPWATests();
        });

        // Log toutes les erreurs JavaScript
        window.addEventListener('error', function(e) {
            console.error('Erreur JavaScript d√©tect√©e:', e.error);
        });

        // Log les erreurs de promesse
        window.addEventListener('unhandledrejection', function(e) {
            console.error('Promesse rejet√©e:', e.reason);
        });
    </script>
</body>
</html>